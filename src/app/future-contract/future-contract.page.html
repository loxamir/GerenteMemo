<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/agro-tabs/future-contract-list"></ion-back-button>
    </ion-buttons>
    <ion-title *ngIf="return">
      {{ 'RETURN' | translate }}: {{futureContractForm.value.code}}
    </ion-title>
    <ion-title *ngIf="!return">
      {{ 'FUTURE_CONTRACT' | translate }}: {{futureContractForm.value.code}}
    </ion-title>
    <ion-buttons slot="end">
      <ion-button icon-only (click)="presentPopover($event)">
        <ion-icon name="more"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-row style="height: 50px;">
    <ion-col>
      <h4 class="field-label-col">{{'TOTAL_AMOUNT' | translate}}</h4>
      <h4 class="field-value-col" style="color:blue">$ {{futureContractForm.value.quantity*(futureContractForm.value.price)|number:'1.'+currency_precision}}</h4>
  </ion-col>
  </ion-row>
  <ion-row  class="state-header">
    <ion-col size="4">
      <div class="clicked arron">
        <span class="state-label">{{'DRAFT'|translate}}</span>
      </div>
    </ion-col>
    <ion-col size="4">
      <div [class.unclicked]="futureContractForm.value.state=='QUOTATION'" [class.clicked]="futureContractForm.value.state!='QUOTATION'" class="arrow">
        <span class="state-label">{{'CONFIRMED'|translate}}</span>
      </div>
    </ion-col>
    <ion-col size="4">
      <div [class.unclicked]="!(futureContractForm.value.state=='CONFIRMED' && (futureContractForm.value.quantity == futureContractForm.value.sold))" [class.clicked]="futureContractForm.value.state=='CONFIRMED' && (futureContractForm.value.quantity == futureContractForm.value.sold)" class="arrow">
        <span class="state-label">{{'DONE'|translate}}</span>
      </div>
    </ion-col>
  </ion-row>
</ion-header>

<ion-content background="#ddd" >
  <ion-input #corpo style="height: 0px;--padding-top: 0px;--padding-bottom: 0px;--padding-start: 0px;"></ion-input>
  <form [formGroup]="futureContractForm" (ngSubmit)="onSubmit(futureContractForm.value)">

    <ion-row justify-content-center>
      <ion-item no-padding class="field-50">
        <ion-label position="floating">{{'QUANTITY' | translate}} (Sacas)</ion-label>
        <ion-input type="number" #quantity formControlName="quantity"></ion-input>
      </ion-item>
      <ion-item no-padding class="field-50">
        <ion-label position="floating">{{'PRICE' | translate}}</ion-label>
        <ion-input type="number" #price formControlName="price"></ion-input>
      </ion-item>
      <ion-item no-padding (click)="selectContact()" class="field-100">
        <h4 class="field-label">{{'CONTACT' | translate }}</h4>
        <h4 class="field-value">{{futureContractForm.value.contact && futureContractForm.value.contact.name || 'SELECT'|translate}}</h4>
      </ion-item>
      <ion-item no-padding (click)="selectCrop()" class="field-50">
        <h4 class="field-label">{{'CROP' | translate }}</h4>
        <h4 class="field-value">{{futureContractForm.value.crop.name || 'SELECT'|translate}}</h4>
      </ion-item>
      <ion-item no-padding class="field-50">
        <h4 class="field-label">{{'DATE' | translate }}</h4>
        <ion-datetime class="field-50-datetime"
        displayFormat="DD/MM/YYYY"
        pickerFormat="DD/MM/YYYY"
        formControlName="date"
        [max]="today.getFullYear()+5">
        </ion-datetime>
      </ion-item>

    </ion-row>

    <ion-item class="field-100">
        <ion-label position="floating">{{'NOTE' | translate}}</ion-label>
        <ion-textarea autoGrow="true" rows="1" #note formControlName="note"></ion-textarea>
    </ion-item>
  </form>

  <ion-fab vertical="bottom" horizontal="center" slot="fixed" *ngIf="futureContractForm.value.state == 'QUOTATION'">
    <ion-button (click)="confirmState()"  class="next-button" color="primary">
      <ion-icon name="checkmark"> </ion-icon>
      {{'CONFIRM'|translate}}
    </ion-button>
  </ion-fab>

  <ion-fab vertical="bottom" horizontal="start" slot="fixed">
    <ion-button (click)="discard()" color="danger" class="discard-button">
      <ion-icon name="backspace" *ngIf="futureContractForm.dirty"> </ion-icon>
      <ion-icon name="arrow-back" *ngIf="!futureContractForm.dirty"> </ion-icon>
      <span *ngIf="futureContractForm.dirty">{{'DISCARD'|translate}}</span>
      <span *ngIf="!futureContractForm.dirty">{{'GO_BACK'|translate}}</span>
    </ion-button>
  </ion-fab>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="futureContractForm.dirty">
    <ion-button (click)="buttonSave()"  color="success" class="save-button">
      <ion-icon name="save"> </ion-icon>
      {{'SAVE'|translate}}
    </ion-button>
  </ion-fab>

  <div style="height: 100px;">
  </div>
</ion-content>
