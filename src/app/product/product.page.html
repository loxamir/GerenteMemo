<ion-header *ngIf="logged">
  <ion-toolbar style="--ion-background-color: {{config.bg_color}};">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/product-list"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'PRODUCT' | translate }}-{{productForm.value.code}}</ion-title>
    <ion-buttons slot="end">
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content class="product-content" style="--background: white;" *ngIf="logged">
  <canvas id="canvas" height=200 width=200 style="display:none"></canvas>
  <div id="pwa">
    <input type="file" id="pwaphoto" #pwaphoto accept="image/*" (change)="previewFile()" style="display: none;">
  </div>
  <form class="sample-form validations-form" [formGroup]="productForm" style="background: white;">
    <div class="scrolling-wrapper-flexbox2" style="background: #a9a9a9;">
      <div class="card" *ngFor="let item of productForm.value.images; let i = index;">
        <ion-item-sliding class="list-item">
          <ion-item class="ion-no-padding">
            <ion-card class="list-card" style="display: inline-block;"
            (click)="openPreview(img)">
            <img
            *ngIf="productForm.value._attachments && productForm.value._attachments[item] && productForm.value._attachments[item].data"
            [src]="'data:image/png;base64,'+productForm.value._attachments[item].data"
            style="height: 140px;width: auto;border-radius: 5px;"/>
          </ion-card>
        </ion-item>
        <ion-item-options>
          <ion-item-option (click)="deleteImage(item)">
            {{ 'DELETE'| translate }}
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
      </div>

      <div class="card" *ngFor="let img of product_images; let i = index;">
        <ion-item-sliding class="list-item">
          <ion-item class="ion-no-padding">
            <ion-card class="list-card" style="display: inline-block;"
            (click)="openPreview(img)">
            <img [src]="img" style="height: 140px;width: auto;border-radius: 5px;"/>
          </ion-card>
        </ion-item>
        <ion-item-options>
          <ion-item-option (click)="deleteImageTmp(img)">
            {{ 'DELETE'| translate }}
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
      </div>

      <div class="card">
        <ion-item class="ion-no-padding">
          <ion-card class="list-card" style="display: inline-block;text-align:center;" (click)="openPWAPhotoPicker()">
            <ion-row style="padding-top:30px">
              <ion-col style="font-size: 30px;">
                <ion-icon name="camera"></ion-icon>
              </ion-col>
            </ion-row>
            <ion-row style="padding-bottom:30px">
              <ion-col style="font-size: 20px;">
                {{'ADD_IMAGES'|translate}}
              </ion-col>
            </ion-row>
          </ion-card>
        </ion-item>
      </div>
    </div>

    <img [src]="'./assets/images/sem_foto.jpg'" id="imageSrc" style="display: none;margin-left: auto;margin-right: auto;">
      <ion-row style="background: white;">
        <!-- <ion-col>
          <ion-row>
            <ion-col> -->
              <ion-item class="field-100">
                <ion-label position="floating">{{'NAME' | translate}}</ion-label>
                <ion-input type="text" formControlName="name"></ion-input>
              </ion-item>
            <!-- </ion-col>
          </ion-row>

          <ion-row>
            <ion-col style="font-size: 12px;"> -->
            <ion-item class="field-100">
              <ion-label position="floating">{{'PRICE' | translate}} ({{'OPTIONAL' | translate}})</ion-label>
              <ion-input type="text" formControlName="price"></ion-input>
            </ion-item>

            <!-- </ion-col>
          </ion-row>
        </ion-col> -->

      </ion-row>
      <ion-row (click)="showFields()" *ngIf="!moreFields" class="more-field">
        <div>
          <ion-icon style="margin-bottom: -2px;" name="chevron-forward-outline"></ion-icon>
            {{'MORE_FIELDS'|translate}}
        </div>
      </ion-row>
      <div *ngIf="moreFields">
        <ion-row (click)="hideFields()" class="more-field">
          <div>
            <ion-icon style="margin-bottom: -2px;" name="chevron-down-outline"></ion-icon>
            {{'LESS_FIELDS'|translate}}
          </div>
        </ion-row>
        <ion-row>
          <ion-item class="field-100">
            <ion-label position="floating">{{'DESCRIPTION' | translate}}</ion-label>
            <ion-input type="text" formControlName="description"></ion-input>
          </ion-item>
          <ion-item class="ion-no-padding" (click)="selectCategory()" class="field-50">
            <h4 class="field-label">{{'CATEGORY' | translate }}</h4>
            <h4 class="field-value">{{productForm.value.category && productForm.value.category.name || 'SELECT'|translate}}</h4>
          </ion-item>
          <ion-item
          class="ion-no-padding"
          class="field-50">
          <ion-label>{{'PUBLISHED' | translate}}</ion-label>
          <ion-toggle formControlName="publish"></ion-toggle>
        </ion-item>
        <ion-item class="field-50">
          <ion-label position="floating">{{'CODE' | translate}}</ion-label>
          <ion-input type="text" formControlName="code"></ion-input>
        </ion-item>
        <ion-item class="field-50">
          <ion-label position="floating">{{'POSITION' | translate}}</ion-label>
          <ion-input type="text" formControlName="sequence"></ion-input>
        </ion-item>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-button class="button-100" (click)="addSize()"><ion-icon name="paper" style="margin-right:10px;"></ion-icon>{{ 'ADD_SIZE' | translate }}</ion-button>
        </ion-col>
      </ion-row>
      <div class="scrolling-wrapper-flexbox2" style="background: white;">
        <div class="card" *ngFor="let item of productForm.value.sizes" >
          <ion-item-sliding class="list-item"  #slidingItem>
            <ion-item class="ion-no-padding" style="--background: white;">
              <ion-card class="list-card"
              style="border: 1px solid #8ebbf3;"
              (click)="editSize(item)">
              <ion-row>
                <ion-col style="color: #ff1919;font-weight:bold;text-align:center;">
                  {{item.name}}
                </ion-col>
              </ion-row>
              <ion-row *ngIf="item.price">
                <ion-col style="color: black;font-weight:bold;text-align:center;">
                  Gs {{item.price|number:'1.0-0'}}
                </ion-col>
              </ion-row>
            </ion-card>
          </ion-item>
          <ion-item-options>
            <ion-item-option (click)="deleteSize(item, slidingItem)">
              {{ 'DELETE'| translate }}
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </div>
    </div>
    <ion-row>
      <ion-col>
        <ion-button class="button-100" (click)="addProduct()"><ion-icon name="paper" style="margin-right:10px;"></ion-icon>{{ 'ADD_RELATED_PRODUCT' | translate }}</ion-button>
      </ion-col>
    </ion-row>
    <div class="scrolling-wrapper-flexbox2" *ngIf="productForm.value.products.length">
      <div class="card" *ngFor="let item of productForm.value.products; let i = index;">
        <ion-item-sliding class="list-item"  #slidingItem>
          <ion-item class="ion-no-padding" style="--background: white;">
            <ion-card class="list-card" style="width: 180px;display: inline-block;border: 1px solid #8ebbf3;">
              <ion-row>
                <ion-col size="4">
                  <img style="height: 50px;width: auto;border-radius: 5px;"
                  src="./assets/images/sem_foto.jpg"
                  *ngIf="!item.images || !item.images.length">
                  <img style="height: 50px;width: auto;border-radius: 5px;"
                  [src]="'https://database.sistemamemo.com/'+database+'/'+item._id+'/'+item.images[0]"
                  *ngIf="item.images && item.images.length && item._attachments && item._attachments[item.images[0]]">
                </ion-col>
                <ion-col class="ion-no-padding">
                  <ion-row class="producto">
                    <ion-col class="ion-no-padding">
                      <h3 class="item-title" style="font-size: 13px;height: 30px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;">{{ item.name }}</h3>
                    </ion-col>
                  </ion-row>
                  <ion-row class="ion-no-padding content-row one-line">
                    <ion-col class="ion-no-padding" style="text-align: right; margin-right: 0.5em;">
                      <h2 *ngIf="config.currency_id == 'currency.PYG'" class="list-big-number" style="color: green;font-size: 13px;">{{item.price| number:'1.'+currency_precision}} G$</h2>
                      <h2 *ngIf="config.currency_id == 'currency.BRL'" class="list-big-number" style="color: green;font-size: 13px;">R$ {{item.price| number:'1.'+currency_precision}}</h2>
                    </ion-col>
                  </ion-row>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col class="item-content">
                  <div style="height: 22px;font-size: 10px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;">
                    {{item.description}}
                  </div>
                </ion-col>
              </ion-row>
            </ion-card>
          </ion-item>
          <ion-item-options>
            <ion-item-option (click)="deleteProduct(item, slidingItem)">
              {{ 'DELETE'| translate }}
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </div>
    </div>
      </div>
  </form>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="productForm.dirty">
    <ion-button (click)="buttonSave()"  color="success" style="font-size: 10px;">
      <ion-icon name="save"> </ion-icon>
      {{'SAVE'|translate}}
    </ion-button>
  </ion-fab>
  <div style="height: 100px;">
  </div>
</ion-content>




<ion-header *ngIf="database && !logged && !product" style="margin-bottom: 5%;">
  <ion-toolbar  style="--background: {{config.bg_color}};">
      <ion-row>
        <ion-col class="ion-no-padding">
          <img
          alt="Logo"
          style="max-width: 100%;max-height: 100px;border-radius: 5px;margin-top: 5px;"
          [src]="'https://database.sistemamemo.com/'+database+'/config.profile/logo.png'">
        </ion-col>
        <ion-col>
          <ion-row>
            <ion-col>
              <h1 style="font-size: 20px;text-align:center;">
                {{config.name}}
              </h1>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col>
              <a target="_blank" href="https://api.whatsapp.com/send?phone={{config.whatsapp}}&text={{'HELLO'|translate}}+{{config.name}}!+{{'VISITOR_MESSAGE'|translate}}" rel="noopener">
                <h1  color="success" style="font-size: 12px;color: green;border-radius: 5px;background: white;max-width: 156px;text-align: center;margin: auto;">
                  <ion-icon name="logo-whatsapp" style="padding-right: 5px;padding-left: 3px;font-size: 25px;"></ion-icon>
                  <div style="display: inline-block;font-size: 17px;vertical-align: super;">
                    {{(config.whatsapp || "").replace("+595", "0").replace("+55", "0")}}
                  </div>
                </h1>
              </a>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
    <ion-buttons slot="start">
        <ion-button
                (click)="exitPage()">
          <ion-icon name="arrow-back"></ion-icon>
        </ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content class="product-content" style="--background: white;"  *ngIf="database && !logged">
  <canvas id="canvas" height=200 width=200 style="display:none"></canvas>
  <form class="sample-form validations-form" [formGroup]="productForm" style="background: white;">
    <ion-slides [options]="sliderOpts">
      <ion-slide *ngFor="let img of product_images">
        <img [src]="img" style="height:250px;" (click)="openPreview(img)" />
      </ion-slide>
    </ion-slides>
    <ion-row style="background: white;">
      <ion-col>
        <ion-row>
          <ion-col>{{this.productForm.value.name}}</ion-col>
        </ion-row>
        <ion-row *ngIf="this.productForm.value.price">
          <ion-col style="font-size: 20px;font-weight:bold;color:green;">{{currency_symbol}} {{this.productForm.value.price| number:'1.'+currency_precision}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col style="font-size: 12px;">{{this.productForm.value.description}}</ion-col>
        </ion-row>
      </ion-col>
      <!-- <ion-col size="2">
        <a href="/product/{{productForm.value._id}}" target="_blank">
          <ion-button  style="font-size: 12px;">
          <ion-icon name="share-social" style="padding-right: 5px;padding-left: 3px;font-size: 25px;"></ion-icon>
        </ion-button>
      </a>
      </ion-col> -->
    </ion-row>
    <h1 *ngIf="productForm.value.sizes.length" style="background: white;font-style: italic;font-weight: bold;font-size: 15px;text-align:center;margin-top: 5px;margin-bottom: 0px;color: #3773e8;">
      {{'AVAILABLE_VARIANTIONS'| translate}}
    </h1>
    <!-- <div class="scrolling-wrapper-flexbox" style="background: white;">
      <div class="card" *ngFor="let item of productForm.value.sizes">
        <div style="padding: 5px">
          <ion-card class="list-card" [class.selected]="item.name == productForm.value.size" (click)="selectSize(item)">
            <ion-row>
              <ion-col style="color: #ff1919;font-weight:bold;text-align:center;">
                {{item.name}}
              </ion-col>
            </ion-row>
            <ion-row *ngIf="item.price">
              <ion-col style="color: black;font-weight:bold">
                Gs {{item.price|number:'1.0-0'}}
              </ion-col>
            </ion-row>
          </ion-card>
        </div>
      </div>
    </div> -->
    <div class="scrolling-wrapper-flexbox2" style="background: white;">
        <div class="card" *ngFor="let item of productForm.value.sizes" >
          <ion-item class="ion-no-padding" style="--background: white;">
            <ion-card class="list-card"
            [class.selected]="item.name == productForm.value.size"
            (click)="selectSize(item)">
              <ion-row>
                <ion-col style="color: #ff1919;font-weight:bold;text-align:center;">
                  {{item.name}}
                </ion-col>
              </ion-row>
              <ion-row *ngIf="item.price">
                <ion-col style="color: black;font-weight:bold;text-align:center;">
                  Gs {{item.price|number:'1.0-0'}}
                </ion-col>
              </ion-row>
            </ion-card>
        </ion-item>
        </div>
      </div>
    <h1 style="font-style: italic;font-weight: bold;font-size: 15px;text-align:center;margin-top: 5px;margin-bottom: 0px;color: #3773e8;" *ngIf="productForm.value.products.length" class="ion-no-padding">
      {{'RELATED_PRODUCTS'| translate}}
    </h1>
    <div class="scrolling-wrapper-flexbox" *ngIf="productForm.value.products.length">
      <div class="card" *ngFor="let item of productForm.value.products; let i = index;">
        <ion-row>
          <ion-card class="list-card" style="width: 180px;display: inline-block;border: 1px solid #8ebbf3;">
            <ion-row (click)="openProduct(item)">
              <ion-col size="4">
                <img
                alt="Foto del producto"
                style="height: 50px;width: auto;border-radius: 5px;"
                *ngIf="item._attachments"
                [src]="'https://database.sistemamemo.com/'+database+'/'+item._id+'/'+item.images[0]">
                <img
                alt="Foto del categoria"
                style="height: 95px;width: auto;"
                *ngIf="!item._attachments"
                src="./assets/images/sem_foto.jpg">
              </ion-col>
              <ion-col class="ion-no-padding">
                <ion-row class="producto">
                  <ion-col class="ion-no-padding">
                    <h3 class="item-title" style="font-size: 13px;height: 30px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;">{{ item.name }}</h3>
                  </ion-col>
                </ion-row>
                <ion-row class="ion-no-padding content-row one-line">
                  <ion-col class="ion-no-padding" style="text-align: right; margin-right: 0.5em;">
                    <h2 class="list-big-number" style="color: green;font-size: 13px;">{{currency_symbol}} {{item.price| number:'1.'+currency_precision}}</h2>
                  </ion-col>
                </ion-row>
                <ion-row class="ion-no-padding content-row one-line">
                  <ion-col class="ion-no-padding" style="text-align: right; margin-right: 0.5em;">
                    <ion-button style="height: 15px;width: 100px;">
                      {{'SHOW'|translate}}
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col class="item-content">
                <div style="height: 25px;font-size: 12px;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;">
                  {{item.description}}
                </div>
              </ion-col>
            </ion-row>
          </ion-card>
        </ion-row>
      </div>
    </div>
  </form>

  <ion-fab vertical="bottom" horizontal="start" slot="fixed">
    <ion-button (click)="exitPage()" color="danger" style="font-size: 12px;--ion-color-base: #FFEB3B !important;--ion-color-contrast: black !important;">
      {{ 'GO_BACK'| translate }}
    </ion-button>
  </ion-fab>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-button (click)="askProduct()" color="success" style="font-size: 12px;">
      {{'ADD_TO_ORDER'|translate}}
    </ion-button>
  </ion-fab>
  <div style="height: 100px;">
  </div>
</ion-content>
