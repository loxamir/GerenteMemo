<ion-header>
  <ion-navbar>
    <ion-title>
      {{ 'SALE' | translate }}: {{saleForm.value.code}}
    </ion-title>

    <ion-buttons end>
      <button ion-button style="background: #2ad078;" (click)="buttonSave()" [hidden]="!saleForm.dirty">
        {{ 'SAVE' | translate }}
      </button>
      <button ion-button icon-only color="royal" (tap)="presentPopover($event)">
        <ion-icon name="more"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
  <ion-row>
    <ion-col width-30>
      <button class="clicked">
        <span class="state-label">Presupuesto</span>
      </button>
    </ion-col>
    <ion-col width-30>
      <button [class.unclicked]="saleForm.value.state=='QUOTATION'" [class.clicked]="saleForm.value.state!='QUOTATION'">
        <span class="state-label">Confirmada</span>
      </button>
    </ion-col>
    <ion-col width-30>
      <button [class.unclicked]="saleForm.value.state!='PAID'" [class.clicked]="saleForm.value.state=='PAID'">
        <span class="state-label">Cobrada</span>
      </button>
    </ion-col>
  </ion-row>
  <ion-row justify-content-center>
    <ion-col width-20 class="sumary-label" no-padding>
      <h4 class="sumary-label">{{'TOTAL' | translate }}</h4>
    </ion-col>
    <ion-col width-30 class="sumary-label" no-padding>
      <h4 class="sumary-value draft" style="text-align: center;margin-top: 1.0rem;margin-bottom: 1rem;">$ {{saleForm.value.total|number:'1.0'}}</h4>
    </ion-col>
    <ion-col width-20 class="sumary-label" no-padding>
      <h4 class="sumary-label">{{'Cobrar' | translate }}</h4>
    </ion-col>
    <ion-col width-30 class="sumary-label" no-padding>
      <h4 class="sumary-value negative" style="text-align: center;margin-top: 1.0rem;margin-bottom: 1rem;">$ {{saleForm.value.residual|number:'1.0'}}</h4>
    </ion-col>
  </ion-row>
</ion-header>

<ion-content class="sale-content" style="background-color: #ddd">
  <form class="sample-form validations-form" [formGroup]="saleForm" (ngSubmit)="onSubmit(saleForm.value)">
    <ion-row justify-content-center>
      <ion-item no-padding (click)="selectContact()" style="width: calc(100% - 0px);background-color: #fff;border: 1px solid #ddd;height: 50px;">
        <h4 class="sumary-label">{{'CLIENT' | translate}}</h4>
        <h4 class="client-name">{{saleForm.value.contact && saleForm.value.contact.name || 'Selecionar'}}</h4>
      </ion-item>
      <ion-item no-padding (click)="selectPaymentCondition()" style="width: calc(50% - 0px);background-color: #fff;border: 1px solid #ddd;height: 50px;">
        <h4 class="sumary-label">{{'Condici√≥n de Pago' | translate }}</h4>
        <h4 class="client-name">{{saleForm.value.paymentCondition && saleForm.value.paymentCondition.name || 'Selecionar'}}</h4>
      </ion-item>
      <ion-item no-padding class="item-content" style="width: calc(50% - 0px);background-color: #fff;border: 1px solid #ddd;height: 50px;">
        <ion-label floating class="sumary-label">{{'DATE' | translate }}</ion-label>
        <ion-datetime class="sale-date" displayFormat="DD/MM/YYYY" pickerFormat="DD/MM/YYYY" class="task-date" formControlName="date" [disabled]="saleForm.value.state!='QUOTATION'">
        </ion-datetime>
      </ion-item>
      <ion-item no-padding (click)="selectSeller()" style="width: calc(50% - 0px);;background-color: #fff;border: 1px solid #ddd;height: 50px;">
        <h4 class="sumary-label">{{'SELLER' | translate }}</h4>
        <h4 class="client-name">{{saleForm.value.seller_name || 'Selecionar'}}</h4>
      </ion-item>
      <ion-item no-padding (click)="selectCurrency()" style="width: calc(50% - 0px);;background-color: #fff;border: 1px solid #ddd;height: 50px;">
        <h4 class="sumary-label">{{'CURRENCY' | translate }}</h4>
        <h4 class="client-name">{{saleForm.value.currency && saleForm.value.currency.name || 'Selecionar'}}</h4>
      </ion-item>
    </ion-row>
    <ion-row>
      <ion-col width-50 class="item-content" *ngIf="saleForm.value.state != 'QUOTATION' && saleForm.value.amount_unInvoiced == saleForm.value.total">
        <button ion-button class="print-invoice" (click)="addInvoice()">Crear Factura</button>
      </ion-col>
      <ion-col width-50 class="item-content" *ngIf="saleForm.value.state == 'CONFIRMED'">
        <button ion-button class="print-invoice" (click)="beforeAddPayment()">Registrar Cobro</button>
      </ion-col>
      <ion-col *ngIf="saleForm.value.state != 'QUOTATION'">
        <button ion-button class="print-confirm" (click)="print()">Imprimir Venta</button>
      </ion-col>
      <ion-col width-50 class="item-content" *ngIf="saleForm.value.state == 'CONFIRMED' && ! saleForm.value.payments.length">
        <button ion-button class="print-invoice" (click)="saleCancel()">Cancelar</button>
      </ion-col>
    </ion-row>
    <ion-card *ngIf="saleForm.value.invoices.length" style="background-color: white">
      <ion-item>
        <ion-row no-padding (click)="openInvoice(item)" *ngFor="let item of saleForm.value.invoices" no-padding>
          <ion-col no-padding>
            <h4 class="sumary-label">{{'INVOICE' | translate}}</h4>
            <h4 class="client-name">{{item.code || item.number}}</h4>
          </ion-col>
          <ion-col no-padding>
            <h4 class="sumary-label">{{'INVOICED' | translate}}</h4>
            <h4 class="client-name">$ {{item.total|number:'1.0'}}</h4>
          </ion-col>
        </ion-row>
      </ion-item>
    </ion-card>
    <ion-card *ngIf="saleForm.value.payments.length">
      <ion-item>
        <ion-row (click)="openPayment(item)" *ngFor="let item of saleForm.value.payments" no-padding>
          <ion-col no-padding>
            <h4 class="sumary-label">{{'RECEIPT' | translate}}</h4>
            <h4 class="client-name">{{item._id}}</h4>
          </ion-col>
          <ion-col no-padding>
            <h4 class="sumary-label">{{'RECEIVED' | translate}}</h4>
            <h4 class="client-name">$ {{item.paid|number:'1.0'}}</h4>
          </ion-col>
        </ion-row>
      </ion-item>
    </ion-card>

    <ion-card *ngIf="saleForm.value.items.length">
      <ion-list no-lines>
        <h2 class="section-title">{{'Items de la Venta' | translate}}</h2>
        <ion-item-sliding class="list-item" *ngFor="let item of saleForm.value.items" style="border-bottom: 1px solid blue;">
          <ion-item>
            <ion-row class="content-row one-line">
              <ion-col width-70 class="item-content" style="white-space: normal;">
                <ion-row (click)="openItem(item)" class="product-name-row">
                  <!-- <ion-col width-20>
                    {{item.product && item.product.code}}
                  </ion-col> -->
                  <ion-col>
                    {{item.product && item.product.name}}
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col width-50 class="item-content price-tag" (click)="editItemPrice(item)">
                    <span class="price-label">Precio:</span> ${{item.price|number:'1.0'}}
                  </ion-col>
                </ion-row>
              </ion-col>
              <ion-col>
                <ion-row>
                  <ion-col width-50 class="item-content">
                    <h4 class="sumary-label">Subtotal</h4> ${{item.price*item.quantity|number:'1.0'}}
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col width-30>
                    <button class="quantity-button" (click)="remItem(item)">-</button>

                  </ion-col>
                  <ion-col (click)="editItemQuantity(item)" width-40 class="item-content" style="text-align: center;top:4px;">
                    {{item.quantity}}
                  </ion-col>
                  <ion-col width-30>
                    <button class="quantity-button" (click)="sumItem(item)">+</button>
                  </ion-col>
                </ion-row>
              </ion-col>
            </ion-row>
          </ion-item>
          <ion-item-options>
            <button ion-button icon-only color="primary" (click)="deleteItem(item)" *ngIf="saleForm.value.state!='QUOTATIONs'">
              <ion-icon name="trash"></ion-icon>
            </button>
          </ion-item-options>
        </ion-item-sliding>
      </ion-list>
    </ion-card>
  </form>
  <ion-fab bottom center>
    <button ion-fab (click)="goNextStep()" color="blue" class="play-button">
      <ion-icon name="play" style="margin-left: 5px;">
      </ion-icon>
    </button>
  </ion-fab>
  <ion-fab bottom right *ngIf="saleForm.value.state == 'QUOTATION'" class="add-product-button">
    <button ion-fab (click)="addItem()" color="green">
      <ion-icon name="add">
      </ion-icon>
    </button>
  </ion-fab>
</ion-content>
