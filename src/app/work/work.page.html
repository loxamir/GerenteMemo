<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/agro-tabs/work-list"></ion-back-button>
    </ion-buttons>
    <ion-title>
      {{ workForm.value.activity && workForm.value.activity.name || 'TASK' | translate }} {{workForm.value.code}}
      <h1 class="subtitle">
        {{ workForm.value.date|date: 'dd/MM/yyyy' }}
      </h1>
    </ion-title>
    <ion-buttons slot="end">
    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content class="work-content" style="background-color: #ddd">

  <form class="sample-form validations-form" [formGroup]="workForm" (ngSubmit)="onSubmit(workForm.value)" >
    <!-- <ion-row justify-content-center *ngIf="!list"  id="teste">
        <ion-item no-padding (click)="selectActivity()" class="field-50">
          <h4 class="field-label">{{'Atividade' | translate}}</h4>
          <h4 class="field-value">{{workForm.value.activity && workForm.value.activity.name || 'Ningun'}}</h4>
        </ion-item>
        <ion-item no-padding class="field-50">
          <h4 class="field-label">{{'DATE' | translate }}</h4>
          <ion-datetime class="field-50-datetime"
          displayFormat="DD/MM/YYYY"
          pickerFormat="DD/MM/YYYY"
          formControlName="date">
          </ion-datetime>
        </ion-item>
    </ion-row> -->
    <!-- <ion-list no-lines>
      <section>
      </section>
    </ion-list> -->
        <ion-row>
          <ion-item-sliding class="list-item"
          *ngFor="let field of filterFields(workForm.value.fields)"
          [style.width]="field.class == 'half-width' ? '50%' : '100%'">
            <ion-item class="field-100" *ngIf="field.type == 'boolean'">
              <ion-label>{{field.label || field.name}}</ion-label>
              <ion-toggle [formControlName]="field.name"></ion-toggle>
            </ion-item>
            <ion-item class="switcher-item" *ngIf="field.type == 'button'">
              <ion-button class="print-invoice"
                  (click)="buttonPress(field)">
                  {{ field.label || field.name }}
                </ion-button>
            </ion-item>
            <ion-item
            class="field-100"
            *ngIf="field.type == 'integer'"
            (ionChange)="recomputeFields()">
              <ion-label position="floating">{{field.label || field.name}}</ion-label>
              <ion-input type="number"
              [disabled]="calculate(field.readonly)"
              [formControlName]="field.name"
              text-center>
              </ion-input>
            </ion-item>
            <ion-item class="field-100"
            *ngIf="field.type == 'float'">
              <ion-label position="floating">{{field.label || field.name}}</ion-label>
              <ion-input type="number"
              [formControlName]="field.name"
              [id]="field.name"
              [disabled]="calculate(field.readonly)"
              text-center
              (ionChange)="recomputeFields()">
              </ion-input>
            </ion-item>
            <ion-item class="field-100" *ngIf="field.type == 'string'">
              <ion-label position="floating">{{field.label || field.name}}</ion-label>
              <ion-input type="text" [formControlName]="field.name" text-center>
              </ion-input>
            </ion-item>
            <ion-item class="field-100" *ngIf="field.type == 'progress'">
              <span style="margin-top: -20px;position: absolute;font-size: 13px;">{{field.label || field.name}}</span>
              <ion-range min="0" max="100" color="primary"
              [formControlName]="field.name"
              pin="true" snaps="true">
                <ion-label slot="start">0</ion-label>
                <ion-label slot="end">100%</ion-label>
              </ion-range>
            </ion-item>
            <ion-item *ngIf="field.type == 'formula'" class="field-100">
              <div class="field-many2one">
                <h4 class="field-label">{{field.label || field.name}}</h4>
                <h4 class="field-value-bigger">{{ fields[field.name] }}</h4>
              </div>
            </ion-item>
            <ion-item *ngIf="field.type == 'many2one'"  class="field-100" (click)="selectM2O(field, field.model, field.context)">
              <div class="field-many2one">
                <h4 class="field-label">{{field.label || field.name}}</h4>
                <h4 class="field-value-bigger">{{workForm.value[field.name] && workForm.value[field.name].name || 'Selecionar'}}</h4>
              </div>
            </ion-item>


            <ion-list style="background-color: #ddd" *ngIf="field.type == 'list' && workForm.value[field.name] && workForm.value[field.name].length > 0">
              <h2 class="section-title" style="color:#1c61f3;background: white;border: 1px solid;border-top-left-radius: 5px;border-top-right-radius: 5px;">{{ field.label || field.name | translate}}</h2>
              <ion-item-sliding class="list-item" *ngFor="let item of workForm.value[field.name]; let i = index;">
                <ion-item style="--background: white;">
                  <div style="width: 100%">
                    <ion-row style="width: 100%" (click)="editFieldItem(field.name, i)">
                      <ion-col *ngFor="let atribute of field.attributes;">
                        <h4 class="field-label" style="margin-top: 0px;">{{atribute.label}}</h4>
                        <h4 class="user-name"  style="margin-bottom: 0px;">{{item[atribute.name] && item[atribute.name].name || item[atribute.name]}}</h4>
                      </ion-col>
                    </ion-row>
                    <ion-row no-padding>
                      <ion-col class="item-content" style="white-space: normal;">
                        {{item.note}}
                      </ion-col>
                    </ion-row>
                  </div>
                </ion-item>
                <ion-item-options>
                  <ion-item-option (click)="removeFieldItem(field.name, i)">
                    Borrar
                  </ion-item-option>
                </ion-item-options>
              </ion-item-sliding>
              <ion-row style="background: #1c61f3;border-radius: 7px;border: 1px solid #1c61f3; border-top-left-radius: 0px;border-top-right-radius: 0px;"
              (click)="addFieldItem(field.name)">
                <a style="color:white;cursor: default;font-size:16px;margin-left: 32%;margin-top: 8px;margin-bottom: 8px;">
                  Agregar {{ field.label || field.name }}
                </a>
              </ion-row>
            </ion-list>



            <ion-item style="background-color: #ddd" *ngIf="field.type == 'list' && workForm.value[field.name].length == 0">
              <ion-row style="background: #1c61f3;border: 1px solid #1c61f3;width: 100%;"
              (click)="addFieldItem(field.name)">
                <a style="color:white;cursor: default;font-size:16px;margin-left: 32%;margin-top: 8px;margin-bottom: 8px;">
                  Agregar {{ field.label || field.name }}
                </a>
              </ion-row>
            </ion-item>

            <ion-item class="field-100" *ngIf="field.type == 'date'" >
              <ion-label position="floating">{{field.label || field.name}}</ion-label>
              <ion-datetime displayFormat="DD/MM/YYYY"
              pickerFormat="DD/MM/YYYY"
              [disabled]="calculate(field.readonly)"
              [formControlName]="field.name">
              </ion-datetime>
            </ion-item>
          </ion-item-sliding>
        </ion-row>


    <ion-segment formControlName="section" class="cash-segment">
      <ion-segment-button class="list-item"
      *ngFor="let field of filterTabs(workForm.value.fields)"
      [value]="field.name">
        {{ field.label }}
      </ion-segment-button>
    </ion-segment>

    <div class="forms-wrapper" *ngFor="let field of filterTabs(workForm.value.fields)">
        <div *ngIf="workForm.value.section == field.name" class="post-example-view">
          <ion-list style="background-color: #ddd;padding-top:3px;padding-bottom: 0px;" *ngIf="field.type == 'tab' && workForm.value[field.name] && workForm.value[field.name].length > 0">
            <ion-item-sliding class="list-item" *ngFor="let item of workForm.value[field.name]; let i = index;">
              <ion-item style="--background: white;">
                <div style="width: 100%">
                  <ion-row (click)="editFieldItem(field.name, i)">
                    <ion-col *ngFor="let atribute of field.attributes;">
                      <h4 class="field-label" style="margin-top: 0px;">{{atribute.label}}</h4>
                      <h4 class="user-name"  style="margin-bottom: 0px;text-align: center;">{{item[atribute.name] && item[atribute.name].name || item[atribute.name]}}</h4>
                    </ion-col>
                  </ion-row>
                  <ion-row no-padding>
                    <ion-col class="item-content" style="white-space: normal;">
                      {{item.note}}
                    </ion-col>
                  </ion-row>
                </div>
              </ion-item>
              <ion-item-options>
                <ion-item-option (click)="removeFieldItem(field.name, i)"
                *ngIf="!item.fixed">
                  Borrar
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>
          </ion-list>
            <ion-col size="12">
              <ion-button
              (click)="addFieldItem(field.name)"
              class="button-100"
              color="success">
                Agregar {{ field.label || field.name }}
              </ion-button>
            </ion-col>
        </div>
    </div>
    <ion-item  class="field-100" style="margin-top: 10px;">
      <ion-label position="stacked">{{ 'NOTE' | translate }}</ion-label>
      <ion-textarea #note formControlName="note"
        rows="2">
      </ion-textarea>
    </ion-item>
  </form>
  <!-- <ion-fab vertical="bottom" horizontal="center" slot="fixed">
    <ion-button (click)="goNextStep()"  class="next-button">
      <ion-icon name="fastforward"> </ion-icon>
      Proximo
    </ion-button>
  </ion-fab> -->

  <ion-fab vertical="bottom" horizontal="start" slot="fixed">
    <ion-button (click)="discard()" color="danger" class="discard-button">
      <ion-icon name="backspace" *ngIf="workForm.dirty"> </ion-icon>
      <ion-icon name="arrow-back" *ngIf="!workForm.dirty"> </ion-icon>
      <span *ngIf="workForm.dirty">Descartar</span>
      <span *ngIf="!workForm.dirty">Volver</span>
    </ion-button>
  </ion-fab>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="workForm.dirty">
    <ion-button (click)="buttonSave()"  color="success" class="save-button">
      <ion-icon name="save"> </ion-icon>
      Guardar
    </ion-button>
  </ion-fab>
  <div style="height: 100px;">
  </div>
</ion-content>
